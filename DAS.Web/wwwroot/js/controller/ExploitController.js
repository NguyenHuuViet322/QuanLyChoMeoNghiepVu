var ExploitConfig = {
    Init: function () {
        jQuery(document).on("click", ".switchMode", function (e) {
            e.preventDefault();
            var btn = jQuery(this);
            //switch div
            jQuery(btn.attr("data-target-basic")).toggle("fast");
            jQuery(btn.attr("data-target-adv")).toggle("fast");
            //switch text
            //if (btn.text().trim() == btn.attr("data-text-basic"))
            //    jQuery(".switchMode").text(btn.attr("data-text-adv"));
            //else
            //    jQuery(".switchMode").text(btn.attr("data-text-basic"));
            var url = CommonJs.UpdateQueryStringParameter(window.location.href, "IsAdvSearch", btn.hasClass("isAdvSearch") ? 0 : 1);
            window.history.pushState(null, "", url);

            return false;
        });
        jQuery(document).on("click", ".delCondition", function (e) {
            e.preventDefault();

            var obj = jQuery(this);
            var parent = obj.closest(".condition");
            var container = obj.closest(".conditions");
            var cIndex = parent.index();

            parent.remove();
            //Đánh lại index
            const regex = /\[[0-9]+\]/gm;
            const regex2 = /(Value)[0-9]+\"/gm;
            container.find("select.select2-hidden-accessible").select2('destroy');
            container.find(".condition").each(function (i, row) {
                if (i >= cIndex) {
                    jQuery(row).find("input,select").each(function () {
                        var tagName = jQuery(this).prop("tagName").toLowerCase();
                        if (tagName == "select") {
                            jQuery(this).find("option[value='" + jQuery(this).val() + "']")
                                .attr("selected", "true");
                        } else {
                            jQuery(this).attr("value", jQuery(this).val());
                        }
                    });
                    jQuery(row).html(jQuery(row).html().replace(regex2, 'Value' + i + '"')
                        .replace(regex, "[" + i + "]"));
                }
            });
            CommonJs.DateTimeFormat();
            CommonJs.UpdateSelect2(container);
            return false;
        });
        jQuery(document).on("click", ".addCondition", function (e) {
            e.preventDefault();
            var btn = jQuery(this);

            var target = btn.data("target");

            jQuery(target).find("select.select2").select2("destroy");
            var cRowIndex = jQuery(target).find(".condition").length;

            var tempRow = jQuery(jQuery(btn.attr("data-temp")).clone().html());
            //Append and replace index
            //const regex = /\[[0-9]+\]/gm;
            const regex2 = /(Value)[0-9]+\"/gm;
            tempRow.html(tempRow.html().replace(regex2, 'Value' + cRowIndex + '"').replaceAll("[0]", "[" + cRowIndex + "]"));

            tempRow.find(":input").each(function () {
                var inp = jQuery(this);
                var tagName = inp.prop("tagName");
                if (tagName.toLowerCase() == "select") {
                    if (inp.hasClass("select2-not-render"))
                        inp.addClass("select2");
                    inp.val(inp.find("option:first").val());
                } else {
                    inp.val("");
                }
            });
            jQuery(target).append(tempRow);
            tempRow.hide().fadeIn("slow");

            CommonJs.UpdateSelect2(jQuery(target));
            return false;
        });
        jQuery(document).on("change", ".onChangeField", function (e) {
            e.preventDefault();
            var obj = jQuery(this);
            var url = obj.attr("data-url");
            var parent = obj.closest(".condition");
            var target = parent.find(obj.attr("data-target"));
            var index = parent.index()
            jQuery.ajax({
                async: true,
                url: url,
                data: { id: obj.val() },
                success: function (rs) {
                    //Append and replace index
                    const regex = /\[[0-9]+\]/gm;
                    const regex2 = /(Value)[0-9]+\"/gm;

                    target.html(rs.replace(regex2, 'Value' + index + '"').replaceAll(regex, "[" + index + "]"));
                    CommonJs.DateTimeFormat();
                    CommonJs.UpdateIsNumber(target);
                }
            });
            return false;
        });
        jQuery(document).on("change", ".onChangeDocType", function (e) {
            e.preventDefault();
            var obj = jQuery(this);
            var url = obj.attr("data-url");
            var target = $(obj.attr("data-target"));
            jQuery.ajax({
                async: true,
                url: url,
                data: { id: obj.val() },
                success: function (rs) {
                    jQuery("#divConditions").find(".condition:not(.default)").remove();
                     
                    //Append and replace index 
                    target.each(function() {
                        jQuery(this).html(rs.data);
                        jQuery(this).trigger("change");
                    });

                    CommonJs.DateTimeFormat();
                    CommonJs.UpdateIsNumber(target);
                }
            });
            return false;
        });
    },
};